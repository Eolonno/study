--1. ???????? ?????? ???? ???????????? PDB ? ?????? ?????????? ORA12W. ?????????? ?? ??????? ?????????.
select * from v$pdbs;

--2. ????????? ?????? ? ORA12W, ??????????? ???????? ???????? ???????????.
select * from v$instance;


--3. ????????? ?????? ? ORA12W, ??????????? ???????? ???????? ????????????? ??????????? ???? Oracle 12c ? ?? ?????? ? ??????. 
select * from dba_registry;

--4. ???????? ??????????? ????????? PDB (?????????? ???????????? ? ??????? ? ?????????? ?????????? ? ??????????? Database Configuration Assistant) ? ?????? XXX_PDB, ??? XXX – ???????? ????????. 
alter pluggable database AYV_PDB open; -- open the PDB

--5. ???????? ?????? ???? ???????????? PDB ? ?????? ?????????? ORA12W. ?????????, ??? ????????? PDB-???? ?????? ??????????.
select * from v$pdbs;


--6. ???????????? ? XXX_PDB c ??????? SQL Developer ???????? ???????????????? ??????? (????????? ????????????, ????, ??????? ????????????, ???????????? ? ?????? U1_XXX_PDB).
--from AYV_PDB
create tablespace TS_AYV_PDB
datafile 'Z:/LW #4/TS_AYV_PDB.dbf'
size 7M
autoextend on next 5M
maxsize 20M
extent management local; 

create temporary tablespace TS_AYV_PDB_TEMP
tempfile 'Z:/LW #4/TS_AYV_PDB_TEMP.dbf'
size 5M
autoextend on next 3M
maxsize 30M
extent management local;

alter session set "_ORACLE_SCRIPT"=true;  
create role RL_AYVCORE_PDB;

grant create session,
      create table,
      create view,
      create procedure,
      drop any table,
      drop any view,
      drop any procedure to RL_AYVCORE_PDB;

create profile PF_AYVCORE_PDB limit
  password_life_time 180 --number of password's days alive
  sessions_per_user 3 -- number of user's sessions
  failed_login_attempts 7 --number of loggin attempts
  password_lock_time 1 --number of locked days after failed login
  password_reuse_time 10 --after this days number you can repeat password
  password_grace_time default --days number of warning about change password
  connect_time 180 --in minute
  idle_time 30 --in minute    

create user U1_AYV_PDB identified by Pa$$w0rd
  default tablespace TS_AYV_PDB quota unlimited on TS_AYV_PDB
  temporary tablespace TS_AYV_PDB_TEMP
  profile PF_AYVCORE_PDB
  account unlock;

grant RL_AYVCORE_PDB to U1_AYV_PDB;
      
--drop user U1_AYV_PDB;


--7. ???????????? ? ???????????? U1_XXX_PDB, ? ??????? SQL Developer, ???????? ??????? XXX_table, ???????? ? ??? ??????, ????????? SELECT-?????? ? ???????.
-- for U1_AYV_PDB
create table AYV_table
(
  x number
);
insert into AYV_table values (1);
select * from AYV_table;

--8. ? ??????? ????????????? ??????? ???? ?????? ??????????, ??? ????????? ????????????, ???  ????? (???????????? ? ?????????), 
--??? ???? (? ???????? ?? ??????????), ??????? ????????????, ???? ?????????????  ???? ?????? XXX_PDB ?  ??????????? ?? ????.
-- from AYV_PDB
select * from user_tablespaces;

select * from dba_data_files;
select * from dba_temp_files;

select * from dba_roles;
select * from dba_role_privs order by grantee;

select * from dba_profiles;
select * from dba_users;

select u.username, r.granted_role
  from dba_users u
  join dba_role_privs r on u.username = r.grantee;

--9. ????????????  ? CDB-???? ??????, ???????? ?????? ???????????? ? ?????? C##XXX, ????????? ??? ??????????, 
--??????????? ??????????? ? ???? ?????? XXX_PDB. ???????? 2 ??????????? ???????????? C##XXX 
--? SQL Developer ? CDB-???? ?????? ?  XXX_PDB – ???? ??????. ????????? ?? ?????????????????.  
-- from AYV
create user c##AYV identified by Pa$$w0rd
account unlock;
grant create session to C##AYV;

-- from AYV_pdb
grant create session to c##AYV;

--11
-- from AYV_pdb
select * from v$session where username is not null;

--12
select * from dba_data_files;
--13
-- from sysdba
alter pluggable database AYV_pdb close immediate;
drop pluggable database AYV_pdb;


-- drop all
drop user c##AYV cascade;